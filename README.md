# Bike Speedometer

**Качественное измерение скорости велосипеда (или другого транспорта), считывая вращение колеса**

---

## Описание

Проект **bike_speedometer** позволяет в реальном времени измерять скорость вашего велосипеда и отображать её на Android-устройстве.
Состоит из двух компонентов:
1. **ESP32** — микроконтроллер, считывающий данные с датчика (например, Холла) и передающий их по Bluetooth/Wi-Fi.
2. **Android-приложение** на Kotlin, принимающее данные для их отображения, системазации, постороения графика

---

## Технологии

- **ESP32**
  - Язык: MicroPython
  - Датчик Холла (возможно использование других датчиков)
  - Связь: Bluetooth LE или Wi-Fi
- **Android-приложение**
  - Язык: Kotlin
  - Android SDK (минимум API 21+)
___

## Принцип вычисления скорости

В основе расчёта скорости лежит физический подход: зная окружность колеса и время между двумя последовательными импульсами датчика Холла, можно получить мгновенную скорость движения. Но для получения постоянных данных этого не достаточно, так как при остановке движения данные обновляться не будут.
## Решение
Для решения этой проблемы была придумана новая система. Данные будут отправляться с ESP32 не при обновлении, а через равные промежутки времени, при этом скорость будет вычисляться по такому принципу: если с момента прошлого приближенения магнита прошло меньше времени, чем от позапрошлого до прощлого, то отправляем последние данные. Но если новое время превышает предидущее, то мы вычислем "предполагаемую" скорость, как будто магнит приблизился сейчас.

## Пример
<pre>
1          2          3
|--*----*--|---*------|
   ^0.4c^      ^-0.5c-^
* - приближения магнита
| - моменты отправки данных
</pre>

К моменту третьей отправки данных магнит ещё не приблизился для вычисления данных. Старые данные нет смысла отправлять по понятным причинам. Поэтому в момент 3 мы вычисляем скорость, если бы колесо сделало оборот за превышенное время (в данном примере 0,5 с). Также поступаем при дальнейшей отправке данных, если магнит не приблизился. Если после таких вычислений скорость падает меньше 3 км/ч, то считаем её равной нулю, чтобы не забивать данные пренебрежимо малыми скоростями.